<!-- fragments/navbar.html -->
<div th:fragment="navbar(currentUser)">
  <!-- â–¼ fragmentì™€ í•¨ê»˜ ì‚½ì…ë˜ëŠ” ìŠ¤íƒ€ì¼: ì–´ë””ì— includeí•´ë„ ë™ì‘ -->
  <style>
    /* ìŠ¤ì½”í”„ ë˜í¼ */
    #nav-scope { display:flex; align-items:center; background:#171a21; padding:20px; }
    #nav-scope .menu-right { display:flex; align-items:center; margin-left:auto; }
    #nav-scope a { color:#c6d4df; text-decoration:none; }
    #nav-scope a:hover { color:#ffffff; }

    /* ë‹‰ë„¤ì„/ë¡œê·¸ì•„ì›ƒ ë¬¶ìŒ */
    #nav-scope .user-menu { display:inline-flex; align-items:center; gap:20px; }

    /* ë‹‰ë„¤ì„ */
    #nav-scope .user-nick {
      margin-left:40px; color:#3ecf8e; font-weight:bold; text-decoration:none;
      position:relative; z-index:2; /* í™•ì¥ hover ë²„í¼ ìœ„ì— ì˜¤ë„ë¡ */
    }

    /* ë‹‰ë„¤ì„ë§Œ ê¸°ì¤€ì  (ë ˆì´ì•„ì›ƒ ë³€í˜• ì—†ìŒ) */
    #nav-scope #nickWrap { position:relative; display:inline-block; }

    /* ğŸ”¥ Hover ë²”ìœ„ í™•ì¥ ë²„í¼(ë³´ì´ì§€ ì•ŠìŒ): ë‹‰ë„¤ì„ ì£¼ë³€+ì•„ë˜ìª½ ê°­ì„ ë©”ì›€ */
    #nav-scope #nickWrap::before,
    #nav-scope #nickWrap::after {
      content:"";
      position:absolute;
      z-index:1;
    }
    /* ì¢Œìš°/ìœ„ì•„ë˜ ì—¬ìœ  ì˜ì—­ */
    #nav-scope #nickWrap::before {
      top:-6px; bottom:-6px; left:-10px; right:-10px;
    }
    /* ë‹‰ë„¤ì„ê³¼ ë“œë¡­ë‹¤ìš´ ì‚¬ì´ì˜ 'ë¸Œë¦¬ì§€' ì˜ì—­(ê¹œë¹¡ì„ ë°©ì§€) */
    #nav-scope #nickWrap::after {
      top:100%; left:-12px; right:-12px; height:16px;
    }

    /* â–¼ ë“œë¡­ë‹¤ìš´ ë°•ìŠ¤: ë‹‰ë„¤ì„ ì •ì¤‘ì•™ ì•„ë˜ë¡œ, ì‚´ì§ ì¶•ì†Œ */
    #nav-scope #friendMenu {
      position:absolute;
      top:calc(100% + 6px);
      left:50%;                 /* ì¤‘ì•™ ê¸°ì¤€ */
      right:auto;
      transform:translateX(-50%);
      min-width:150px;          /* 180 â†’ 150ìœ¼ë¡œ ì¶•ì†Œ */
      width:max-content;        /* ë‚´ìš©ì— ë§ì¶¤ */
      max-width:220px;          /* ë„ˆë¬´ ê¸¸ì–´ì§€ì§€ ì•Šê²Œ */
      background:#1b2838;
      border:1px solid #2a475e;
      border-radius:8px;
      padding:8px;              /* 10px â†’ 8px */
      display:none !important;  /* ì „ì—­ CSS ì¶©ëŒ ë°©ì§€ */
      box-shadow:0 8px 20px rgba(0,0,0,.35);
      z-index:1000;
      text-align:center;        /* ë‚´ë¶€ í…ìŠ¤íŠ¸ ì¤‘ì•™ ì •ë ¬ ë°±ì—… */
    }

    /* ë‹‰ë„¤ì„ hover/í¬ì»¤ìŠ¤ì¼ ë•Œë§Œ ë³´ì´ê¸° (ë²„í¼ ë•ë¶„ì— ì ‘ê·¼ ì‰¬ì›€) */
    #nav-scope #nickWrap:hover  #friendMenu,
    #nav-scope #nickWrap:focus-within #friendMenu {
      display:block !important;
    }

    /* 'íšŒì› ê²€ìƒ‰' / 'ë°›ì€ ì´ˆëŒ€' ë§í¬: ì¤‘ì•™ ì •ë ¬ + ì»´íŒ©íŠ¸ + í…Œë‘ë¦¬ ì œê±° */
    #nav-scope .friend-link {
      display:block;               /* ë„“ì€ í´ë¦­ ì˜ì—­ */
      padding:8px 10px;            /* ì»´íŒ©íŠ¸ */
      border-radius:6px;
      color:#c6d4df;
      text-decoration:none;
      white-space:nowrap;
      text-align:center;           /* âœ… ì¤‘ì•™ ì •ë ¬ */
      border:none;                 /* âœ… ë²„íŠ¼ í…Œë‘ë¦¬ ì œê±° */
      outline:none;                /* ê¸°ë³¸ ì•„ì›ƒë¼ì¸ ì œê±° (ì•„ë˜ box-shadowë¡œ ëŒ€ì²´) */
    }
    #nav-scope .friend-link:hover { background:#2a475e; color:#fff; }
    #nav-scope .friend-link + .friend-link { margin-top:4px; } /* ë²„íŠ¼ ê°„ê²© ì¶•ì†Œ */

    /* ì ‘ê·¼ì„± í¬ì»¤ìŠ¤: outline ëŒ€ì‹  box-shadowë¡œ í‘œì‹œ (ì‹œê°ì  í…Œë‘ë¦¬ ëŠë‚Œ ìµœì†Œí™”) */
    #nav-scope .user-nick:focus,
    #nav-scope .friend-link:focus {
      outline:none;
      box-shadow:0 0 0 2px #66c0f4;
      border-radius:6px;
    }
  </style>

  <div id="nav-scope">
    <!-- ì™¼ìª½: ë¡œê³  -->
    <div style="flex-shrink:0;">
      <a href="/" style="text-decoration:none;">
        <h1 style="margin:0; color:#66c0f4;">Steam</h1>
      </a>
    </div>

    <!-- ì˜¤ë¥¸ìª½: ë©”ë‰´ -->
    <nav class="menu-right">
      <a href="/shop/product" style="margin-left:20px;">ìƒì </a>

      <a th:if="${currentUser != null}"
         th:href="@{/library/{memberId}(memberId=${currentUser.id})}"
         style="margin-left:20px;">ë¼ì´ë¸ŒëŸ¬ë¦¬</a>

      <a href="/galleries" style="margin-left:20px;">ì»¤ë®¤ë‹ˆí‹°</a>

      <a th:if="${currentUser != null}"
         th:href="@{/shoppingCart}"
         style="margin-left:20px;">ì¥ë°”êµ¬ë‹ˆ</a>

      <!-- ë¹„ë¡œê·¸ì¸ -->
      <span sec:authorize="isAnonymous()">
        <a href="/login" style="margin-left:40px; color:#3ecf8e; font-weight:bold;">ë¡œê·¸ì¸</a>
      </span>

      <!-- ë¡œê·¸ì¸: ë‹‰ë„¤ì„ hover ì‹œ ë“œë¡­ë‹¤ìš´ ë…¸ì¶œ -->
      <span sec:authorize="isAuthenticated()" class="user-menu">
        <!-- ë‹‰ë„¤ì„ ë˜í¼(ì—¬ê¸°ì—ë§Œ hover ì ìš©) -->
        <span id="nickWrap">
          <a class="user-nick"
             th:href="@{/profile/{memberId}(memberId=${currentUser.id}, commentPageNum=${0})}"
             th:text="${currentUser.nickName}"
             aria-haspopup="true" aria-expanded="false">í”„ë¡œí•„</a>

          <!-- ë“œë¡­ë‹¤ìš´ ë©”ë‰´ -->
          <div id="friendMenu" role="menu" aria-label="User quick actions">
            <a class="friend-link" role="menuitem" th:href="@{/friendships/{memberId}(memberId=${currentUser.id})}">ì¹œêµ¬ ëª©ë¡</a>
            <a class="friend-link" role="menuitem" th:href="@{/members/search}">íšŒì› ê²€ìƒ‰</a>
            <a class="friend-link" role="menuitem" th:href="@{/friendships}">ë°›ì€ ì´ˆëŒ€</a>
          </div>
        </span>

        <!-- ë¡œê·¸ì•„ì›ƒ: ë“œë¡­ë‹¤ìš´ê³¼ ë¶„ë¦¬(ìœ„ì¹˜ ê³ ì •) -->
        <a th:href="@{/log-out}" style="color:#ff6961; font-weight:bold;">ë¡œê·¸ì•„ì›ƒ</a>
      </span>
    </nav>
  </div>
</div>
